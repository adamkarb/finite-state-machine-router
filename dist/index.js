!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("react")):"function"==typeof define&&define.amd?define(["react"],n):"object"==typeof exports?exports.FSMRouter=n(require("react")):t.FSMRouter=n(t.React)}(window,(function(t){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,e),a.l=!0,a.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)e.d(r,a,function(n){return t[n]}.bind(null,a));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="/dist/",e(e.s=1)}([function(n,e){n.exports=t},function(t,n,e){"use strict";e.r(n),e.d(n,"createMachine",(function(){return R})),e.d(n,"Link",(function(){return U})),e.d(n,"Machine",(function(){return H})),e.d(n,"State",(function(){return Y})),e.d(n,"Transition",(function(){return B})),e.d(n,"useMachine",(function(){return _}));var r=e(0),a=e.n(r);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=function(t){if(t.length){var n=c(a.a.Children.toArray(t),"State");if(n.length)return n;if(t.props&&t.props.children)return t.props.children.reduce((function(t,n){return t=t.concat(c(a.a.Children.toArray(n.props.children),"State"))}),[])}return[]},c=function(t,n){return t.filter((function(t){return t.type.displayName===n}))},u=function(t,n){return n.split(".").pop()===t},l=function(t){return/^:(.+)/.test(t)},s=function(t){return"/"===t},f=function(t){return t.split("/").filter(Boolean)},p=function(t,n){return"/"+f(t).map((function(t){if(l(t)){var e=t.replace(":","");return Object.keys(n).includes(e)?n[e].toString():(console.error("Cannot push to a dynamic URL without supplying the proper parameters: ".concat(t," parameter is missing.")),"undefined")}return t})).join("/")+(window.location.search?window.location.search:"")},d=function t(n,e){var r=e.find((function(t){return t.stack===n})),a=r.childStates,o={path:r.path,stack:r.stack};if(a.length){var i=a.map((function(t){return e.find((function(n){return n.id===t}))})),c=i.find((function(t){return t.initial}))||i[0];if(c.childStates.length)return t(c.stack,e);o.path=c.path||"/",o.stack=c.stack}return o},h=function(t,n,e){var r={params:null,path:null,stack:null,url:t},a=function(t,e){var a=d(t,n),o=a.path,i=a.stack;t!==i&&(r.exact={stack:t,path:e}),r.path=o,r.stack=i,r.url=p(o,r.params)};if(s(t)){a(n[0].stack,t)}else{var o=function(t,n,e){var r={params:{},path:t,stack:null},a=n.find((function(n){return n.path===t}));if(a)return r.path=a.path,r.stack=a.stack,r;if(function(t){return""===t.slice(1)}(t))return r.stack=n.find((function(t){return 1===t.stack.match(/\./g).length&&t.initial})).stack,r;var o=n.filter((function(t){return t.path&&t.path.match(/\/:/g)})).map((function(t){return t.path}));if(o.length){var i=f(t),c=o.find((function(t){var n=f(t);return r.params={},n.length===i.length&&!n.map((function(t,n){return l(t)?(r.params[t.slice(1)]=i[n],!0):t===i[n]})).includes(!1)}));c&&(r.path=c,r.stack=n.find((function(t){return t.path===c})).stack)}if(!r.stack){var u=n.find((function(t){return"*"===t.id}));r.stack="#"+e+".*",u||console.warn('No <State/> configuration matches URL "'.concat(t,", and no catch-all <State id='*' path='/404'/> exists. Consider adding one."))}return r}(t,n,e),i=o.params,c=o.path,u=o.stack;r.params=i,r.path=c,r.stack=u,function(t){return"*"===t.split(".").pop()}(u)||a(u,c)}return r},y=function t(n,e,r){if(function(t){return!t.match(/\./g)}(e))return null;var a=r.find((function(t){return t.stack===e})).transitions;if(a.length){var o=a.find((function(t){var e=t.cond,r=t.event;t.target;return r===n&&(null===e||!0===e)}));if(o)return o}var i=e.split(".").slice(0,-1).join(".");return t(n,i,r)};function m(){return(m=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t}).apply(this,arguments)}var v,g=v||(v={});g.Pop="POP",g.Push="PUSH",g.Replace="REPLACE";var b=function(t){return t};function O(t){t.preventDefault(),t.returnValue=""}function S(){var t=[];return{get length(){return t.length},push:function(n){return t.push(n),function(){t=t.filter((function(t){return t!==n}))}},call:function(n){t.forEach((function(t){return t&&t(n)}))}}}function k(){return Math.random().toString(36).substr(2,8)}function j(t){var n=t.pathname,e=t.search;return(void 0===n?"/":n)+(void 0===e?"":e)+(void 0===(t=t.hash)?"":t)}function w(t){var n={};if(t){var e=t.indexOf("#");0<=e&&(n.hash=t.substr(e),t=t.substr(0,e)),0<=(e=t.indexOf("?"))&&(n.search=t.substr(e),t=t.substr(0,e)),t&&(n.pathname=t)}return n}function x(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(e.push(i.value),!n||e.length!==n);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return e}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return A(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return A(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var P=function(t,n){if(!n)return[[],function(){}];var e=x(Object(r.useState)([]),2),a=e[0],o=e[1];return[a,function(n){var e=n.type,r=n.payload,i=new Date,c="".concat(i.getHours(),":").concat(i.getMinutes(),":").concat(i.getSeconds(),".").concat(i.getMilliseconds()),u=r.event,l=r.target,s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.replace(/_/g," ");return console.group("%cFSM-Router action: %c".concat(t," %c@ ").concat(c),"color: grey; font-weight: normal","font-weight: bold;","color: grey; font-weight: normal")},f=function(){return console.log("%cevent:","color: blue; font-weight: bold;",u)},p=function(){return console.log("%csource:","color: grey; font-weight: bold;",{state:t.current,location:t.location})},d=function(){l.exact?console.log("%ctarget","color: green; font-weight: bold;",{location:l.location,matched:l.exact,state:l.state}):console.log("%ctarget","color: green; font-weight: bold;",{state:l.state,location:l.location})};switch(e){case"TRANSITION":s(),f(),p(),d();break;case"NO_MATCHING_STATE":s("EVENT DISCARDED"),console.log('%cdetails: %cNo matching <State id="%c'.concat(l.state,'%c"/> found.'),"color: red; font-weight: bold;",null,"font-weight: bold; font-family: monospace;",null),f(),p(),console.log("%ctarget","color: green; font-weight: bold;",{state:l.state});break;case"NO_MATCHING_TRANSITION":s("EVENT DISCARDED"),console.log('%cdetails: %cNo matching <Transition id="%c'.concat(u,'%c"/> found within source state or any of its ancestors.'),"color: red; font-weight: bold;",null,"font-weight: bold; font-family: monospace;",null),f(),p();break;case"HISTORY_REPLACE":case"HISTORY_PUSH":case"HISTORY_POP":s(),console.log("%cpath","color: blue; font-weight: bold;",l.location.pathname),p(),d()}console.groupEnd(),o(a.concat({type:e,payload:r}))}]};function N(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(e.push(i.value),!n||e.length!==n);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return e}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return T(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return T(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function E(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function I(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?E(Object(e),!0).forEach((function(n){C(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):E(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function C(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var M=a.a.createContext({});M.displayName="Machine";var R=function(t){return function(n){return D(I(I({},n),t))}},_=function(){var t=Object(r.useContext)(M);return[{current:t.current,history:t.history,id:t.id,params:t.params},t.send]};function D(t){var n=t.children,e=t.history,o=t.id,u=void 0===o?"machine":o,l=t.logging,f=void 0!==l&&l,g=Object(r.useMemo)((function(){return e||function(t){function n(){var t=i.location,n=c.state||{};return[n.idx,b({pathname:t.pathname,search:t.search,hash:t.hash,state:n.usr||null,key:n.key||"default"})]}function e(t){return"string"==typeof t?t:j(t)}function r(t,n){return void 0===n&&(n=null),b(m({},f,{},"string"==typeof t?w(t):t,{state:n,key:k()}))}function a(t){l=t,t=n(),s=t[0],f=t[1],p.call({action:l,location:f})}function o(t){c.go(t)}void 0===t&&(t={});var i=void 0===(t=t.window)?document.defaultView:t,c=i.history,u=null;i.addEventListener("popstate",(function(){if(u)d.call(u),u=null;else{var t=v.Pop,e=n(),r=e[0];if(e=e[1],d.length){if(null!=r){var i=s-r;i&&(u={action:t,location:e,retry:function(){o(-1*i)}},o(i))}}else a(t)}}));var l=v.Pop,s=(t=n())[0],f=t[1],p=S(),d=S();return null==s&&(s=0,c.replaceState(m({},c.state,{idx:s}),"")),{get action(){return l},get location(){return f},createHref:e,push:function t(n,o){var u=v.Push,l=r(n,o);if(!d.length||(d.call({action:u,location:l,retry:function(){t(n,o)}}),0)){var f=[{usr:l.state,key:l.key,idx:s+1},e(l)];l=f[0],f=f[1];try{c.pushState(l,"",f)}catch(t){i.location.assign(f)}a(u)}},replace:function t(n,o){var i=v.Replace,u=r(n,o);d.length&&(d.call({action:i,location:u,retry:function(){t(n,o)}}),1)||(u=[{usr:u.state,key:u.key,idx:s},e(u)],c.replaceState(u[0],"",u[1]),a(i))},go:o,back:function(){o(-1)},forward:function(){o(1)},listen:function(t){return p.push(t)},block:function(t){var n=d.push(t);return 1===d.length&&i.addEventListener("beforeunload",O),function(){n(),d.length||i.removeEventListener("beforeunload",O)}}}}()}),[]),x=N(Object(r.useMemo)((function(){var t,e=i(a.a.Children.toArray(n));if(0===e.length)throw new Error("<Machine/> has no children <State/> nodes! At least one is required to be considered a valid state machine.");return[e,(t=u,function t(n){var e=n.findIndex((function(t){return t.props.initial}));return e=e>=0?e:0,n.reduce((function(n,r,o){var u=r.props,l=u.children,f=u.id,p=u.parallel,d=u.path,h=void 0===d?"/":d,y=i(a.a.Children.toArray(l)),m=c(a.a.Children.toArray(l),"Transition").map((function(t){var n=t.props;return{cond:n.cond||null,event:n.event,sendId:f,target:n.target}}));return n.push({childStates:y.map((function(t){return t.props.id})),id:f,initial:e===o,path:h,stack:"."+f,transitions:m,type:p?"parallel":0===y.length?"atomic":y.length>1?"compound":"default"}),y.length&&t(y).forEach((function(t,e){return n.push({childStates:t.childStates,id:t.id,initial:t.initial,path:s(h)?t.path:s(t.path)?h:h+t.path,stack:"."+f+t.stack,transitions:t.transitions,type:t.type})})),n}),[])}(e).map((function(n){return n.stack="#"+t+n.stack,n})))]}),[n]),2),A=x[0],T=x[1],E=N(Object(r.useMemo)((function(){var t=h(g.location.pathname,T,u),n=(t.exact,t.params),e=(t.path,t.stack),r=t.url;return g.location.pathname!==r&&g.replace(r),[e,n]}),[]),2),C=E[0],R=E[1],_=N(Object(r.useState)({current:C,location:g.location,params:R}),2),D=_[0],H=_[1],L=N(P(D,f),2),U=(L[0],L[1]),G=function(t,n,e,r){var a=p(t,n);a!==g.location.pathname&&g.push(a,{source:e,target:r})};Object(r.useEffect)((function(){return g.listen((function(t){var n=t.action,e=t.location;if(!e.state||!e.state.target||"POP"===n){var r=h(e.pathname,T,u),a=r.exact,o=r.params,i=(r.path,r.stack);r.url;U({type:"HISTORY_".concat(n),payload:{target:{exact:a,params:o,location:g.location,state:i}}}),H({current:i,location:g.location,params:o})}}))}),[g.location.pathname]);var V=I(I({},D),{},{history:g,id:u,send:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=y(t,D.current,T);if(e){var r=n&&n.params||D.params,a=(e.cond,e.event,e.target),o=T.find((function(t){return t.id===a}));if(o){var i=d(o.stack,T),c=i.path,u=i.stack;U({type:"TRANSITION",payload:{event:t,target:{params:r,location:g.location,state:u}}}),H({current:u,location:g.location,params:r}),G(c,r,D.current,u)}else U({type:"NO_MATCHING_STATE",payload:{event:t,target:{params:r,state:a}}})}else U({type:"NO_MATCHING_TRANSITION",payload:{event:t}})}});return a.a.createElement(M.Provider,{value:V},A)}D.displayName="Machine";var H=D;function L(t){var n,e,i=t.children,c=t.className,u=t.disabled,l=void 0!==u&&u,s=t.href,f=void 0===s?"#":s,p=t.onClick,d=t.replace,h=void 0!==d&&d,y=Object(r.useContext)(M),m=(y.current,y.history);return a.a.createElement("a",{className:(n=[c,{"link-exact":f===m.location.pathname,"link-active":m.location.pathname.includes(f)&&!l,disabled:l}],e=n.map((function(t){switch(o(t)){case"string":return t;case"object":return Object.keys(t).filter((function(n){return Boolean(t[n])})).join(" ").trim();default:return null}})).join(" ").trim(),Boolean(e)?e:null),href:f,onClick:function(t){(t.preventDefault(),l)||(m[h?"replace":"push"](f),p&&p(t))}},i)}L.displayName="Link";var U=L,G=a.a.createContext({id:null,path:null,stack:null});function V(t){var n=t.children,e=t.component,o=t.id,i=(t.initial,t.path),c=Object(r.useContext)(M),l=(c.event,c.current),s=c.history,f=c.id,p=c.params,d=c.send,h=Object(r.useContext)(G),y=(h.id,h.path),m=h.stack,v=m?"".concat(m,".").concat(o):"#".concat(f,".").concat(o),g=i?y?y+i:i:y,b=!!function(t,n){return!!n.split(".").find((function(n){return n===t}))}(o,l)&&{exact:u(o,l),params:p,path:g,url:s.location.pathname},O={id:o,path:g,stack:v,send:d},S={children:n,history:s,machine:{current:l,send:d},match:b};return b?a.a.createElement(G.Provider,{value:O},e?a.a.createElement(e,S):n):null}G.displayName="StateNode",V.displayName="State";var Y=V,q=function(t){return null};q.displayName="Transition";var B=q}])}));
//# sourceMappingURL=index.js.map